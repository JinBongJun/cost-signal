# Paddle Webhook 서명 검증 - 쉽게 설명하기

## 🎯 이 기능이 하는 일

**간단히 말하면:** "이 요청이 정말 Paddle에서 온 것인지 확인하는 보안 기능"

---

## 🤔 왜 필요한가요?

### 문제 상황
- 누군가가 가짜 결제 알림을 보낼 수 있음
- 예: "고객이 결제했어요!" 라는 가짜 메시지
- → 실제로는 결제 안 했는데, 우리 시스템이 "결제 완료"로 처리해버림 😱

### 해결 방법
- Paddle이 보낸 메시지에는 **특별한 서명(도장)**이 있음
- 우리가 그 서명을 확인해서 진짜인지 가짜인지 판단
- → 가짜 메시지는 거부, 진짜 메시지만 처리 ✅

---

## 🔐 어떻게 작동하나요?

### 1. Paddle이 메시지를 보낼 때
```
Paddle: "고객이 결제했어요! [서명: abc123xyz]"
```

### 2. 우리가 받았을 때
```
우리 시스템: "서명이 맞는지 확인해볼게..."
→ 서명 확인 ✅ → "진짜네! 처리하자"
→ 서명 확인 ❌ → "가짜네! 무시하자"
```

---

## 🛡️ 보안 기능 3가지

### 1. **서명 검증** (도장 확인)
- Paddle이 보낸 특별한 "도장"이 맞는지 확인
- 가짜 도장은 통과 못함

### 2. **시간 확인** (오래된 메시지 차단)
- 5분 이상 오래된 메시지는 거부
- 예: 해커가 예전에 훔친 메시지를 다시 보내는 것 방지

### 3. **타이밍 공격 방지**
- 해커가 "서명 확인하는데 얼마나 걸리나?"를 측정해서 비밀번호를 알아내는 공격 방지
- 항상 같은 시간에 확인하도록 처리

---

## 💡 실생활 비유

### 편지 비유
1. **Paddle이 편지를 보낼 때:**
   - 편지에 특별한 도장을 찍어서 보냄
   - 도장은 비밀 키로만 만들 수 있음

2. **우리가 편지를 받았을 때:**
   - 도장이 진짜인지 확인
   - 도장이 맞으면 → "진짜 편지네! 처리하자"
   - 도장이 안 맞으면 → "가짜 편지네! 버리자"

3. **시간 확인:**
   - 편지에 날짜가 찍혀있음
   - 너무 오래된 편지(5분 이상)는 무시
   - → 해커가 예전 편지를 다시 보내는 것 방지

---

## 📝 코드에서 어떻게 사용하나요?

### 간단한 예시

```typescript
// 1. Paddle이 보낸 메시지 받기
const body = "고객이 결제했어요...";
const signature = "ts=1234567890;h1=abc123xyz"; // Paddle이 보낸 서명

// 2. 서명 확인
const isValid = verifyWebhookSignature(body, signature);

// 3. 결과에 따라 처리
if (isValid) {
  // ✅ 진짜 메시지 → 결제 처리
  console.log("결제 완료 처리");
} else {
  // ❌ 가짜 메시지 → 거부
  console.log("가짜 메시지, 무시");
}
```

---

## ✅ 이 기능의 장점

1. **보안 강화**
   - 가짜 결제 알림 차단
   - 실제 결제만 처리

2. **자동화**
   - 환경 변수에 secret만 설정하면 자동으로 작동
   - 복잡한 설정 불필요

3. **안전한 비교**
   - 타이밍 공격 방지
   - 해커가 비밀번호를 알아낼 수 없음

---

## 🎓 요약

**이 기능 = "Paddle이 보낸 메시지인지 확인하는 보안 경비원"**

- ✅ 진짜 메시지 → 통과시켜서 처리
- ❌ 가짜 메시지 → 차단해서 무시
- ⏰ 오래된 메시지 → 차단 (replay attack 방지)

**결과:** 안전하게 결제 알림만 처리할 수 있음! 🎉

